<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>toblog.dev</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/e3b6090.js" as="script"><link rel="preload" href="/_nuxt/cf78498.js" as="script"><link rel="preload" href="/_nuxt/e5a50fc.js" as="script"><link rel="preload" href="/_nuxt/f8e746f.js" as="script"><link rel="preload" href="/_nuxt/9414bce.js" as="script"><style data-vue-ssr-id="382a115c:0 0d8b0c4d:0 a57b151a:0">/*! tailwindcss v3.3.3 | MIT License | https://tailwindcss.com*/*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}*,::after,::before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-scroll-snap-strictness:proximity;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000}::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-scroll-snap-strictness:proximity;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000}.static{position:static}.m-1{margin:.25rem}.m-12{margin:3rem}.m-4{margin:1rem}.mx-auto{margin-left:auto;margin-right:auto}.my-1{margin-top:.25rem;margin-bottom:.25rem}.my-10{margin-top:2.5rem;margin-bottom:2.5rem}.my-2{margin-top:.5rem;margin-bottom:.5rem}.my-3{margin-top:.75rem;margin-bottom:.75rem}.mr-4{margin-right:1rem}.flex{display:flex}.grid{display:grid}.h-6{height:1.5rem}.w-6{width:1.5rem}.max-w-2xl{max-width:42rem}.max-w-4xl{max-width:56rem}.gap-4{gap:1rem}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-20>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(5rem * var(--tw-space-y-reverse))}.space-y-6>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.rounded-b{border-bottom-right-radius:.25rem;border-bottom-left-radius:.25rem}.border-t-4{border-top-width:4px}.bg-blue-300{--tw-bg-opacity:1;background-color:rgb(147 197 253 / var(--tw-bg-opacity))}.bg-blue-700{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity))}.bg-cyan-300{--tw-bg-opacity:1;background-color:rgb(103 232 249 / var(--tw-bg-opacity))}.bg-cyan-700{--tw-bg-opacity:1;background-color:rgb(14 116 144 / var(--tw-bg-opacity))}.bg-emerald-300{--tw-bg-opacity:1;background-color:rgb(110 231 183 / var(--tw-bg-opacity))}.bg-emerald-700{--tw-bg-opacity:1;background-color:rgb(4 120 87 / var(--tw-bg-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity))}.bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity))}.bg-green-300{--tw-bg-opacity:1;background-color:rgb(134 239 172 / var(--tw-bg-opacity))}.bg-green-700{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity))}.bg-indigo-300{--tw-bg-opacity:1;background-color:rgb(165 180 252 / var(--tw-bg-opacity))}.bg-indigo-700{--tw-bg-opacity:1;background-color:rgb(67 56 202 / var(--tw-bg-opacity))}.bg-lime-300{--tw-bg-opacity:1;background-color:rgb(190 242 100 / var(--tw-bg-opacity))}.bg-orange-300{--tw-bg-opacity:1;background-color:rgb(253 186 116 / var(--tw-bg-opacity))}.bg-orange-700{--tw-bg-opacity:1;background-color:rgb(194 65 12 / var(--tw-bg-opacity))}.bg-pink-300{--tw-bg-opacity:1;background-color:rgb(249 168 212 / var(--tw-bg-opacity))}.bg-pink-700{--tw-bg-opacity:1;background-color:rgb(190 24 93 / var(--tw-bg-opacity))}.bg-purple-300{--tw-bg-opacity:1;background-color:rgb(216 180 254 / var(--tw-bg-opacity))}.bg-purple-700{--tw-bg-opacity:1;background-color:rgb(126 34 206 / var(--tw-bg-opacity))}.bg-rose-300{--tw-bg-opacity:1;background-color:rgb(253 164 175 / var(--tw-bg-opacity))}.bg-rose-700{--tw-bg-opacity:1;background-color:rgb(190 18 60 / var(--tw-bg-opacity))}.bg-sky-300{--tw-bg-opacity:1;background-color:rgb(125 211 252 / var(--tw-bg-opacity))}.bg-sky-700{--tw-bg-opacity:1;background-color:rgb(3 105 161 / var(--tw-bg-opacity))}.bg-teal-300{--tw-bg-opacity:1;background-color:rgb(94 234 212 / var(--tw-bg-opacity))}.bg-teal-700{--tw-bg-opacity:1;background-color:rgb(15 118 110 / var(--tw-bg-opacity))}.bg-violet-300{--tw-bg-opacity:1;background-color:rgb(196 181 253 / var(--tw-bg-opacity))}.bg-violet-700{--tw-bg-opacity:1;background-color:rgb(109 40 217 / var(--tw-bg-opacity))}.bg-yellow-300{--tw-bg-opacity:1;background-color:rgb(253 224 71 / var(--tw-bg-opacity))}.bg-yellow-700{--tw-bg-opacity:1;background-color:rgb(161 98 7 / var(--tw-bg-opacity))}.fill-current{fill:currentColor}.p-12{padding:3rem}.p-4{padding:1rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-16{padding-top:4rem;padding-bottom:4rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.text-left{text-align:left}.text-center{text-align:center}.text-5xl{font-size:3rem;line-height:1}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-thin{font-weight:100}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity))}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1),0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.nuxt-content-highlight{background:#f9f9f9;color:#242424;padding:14px;border:1px solid #e5e5e5;border-radius:4px}.language-text{background:#f9f9f9!important}.nuxt-content p code{background:#efefef}.nuxt-content p{text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;display:block;margin-block-start:1em;margin-block-end:1em;margin-inline-start:0;margin-inline-end:0;color:#242424;font-style:normal;word-break:break-word;font-weight:400;letter-spacing:-.003em;line-height:28px;font-size:18px;margin-bottom:-.46em;margin-top:1.56em}.nuxt-content a{background:#efefef;color:#333;-webkit-text-decoration:underline dashed;text-decoration:underline dashed}.nuxt-content a:hover{background:#333;color:#efefef;-webkit-text-decoration:underline dashed;text-decoration:underline dashed}.nuxt-content ul{list-style-position:inside}.nuxt-content li{list-style-type:square}.nuxt-content h2{color:#242424;font-weight:600;font-size:20px}.nuxt-content h3,.nuxt-content h4{color:#242424;font-size:18px;font-weight:600;border-left:3px solid #333;padding-left:10px}pre{background:0 0!important}@media (min-width:768px){.md\:m-12{margin:3rem}.md\:my-3{margin-top:.75rem;margin-bottom:.75rem}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:p-12{padding:3rem}.md\:py-40{padding-top:10rem;padding-bottom:10rem}.md\:text-right{text-align:right}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}.md\:text-base{font-size:1rem;line-height:1.5rem}.md\:font-medium{font-weight:500}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}</style><link rel="preload" href="/_nuxt/static/1712236976/2024-04-04-exploring-state-in-jetpack-compose/state.js" as="script"><link rel="preload" href="/_nuxt/static/1712236976/2024-04-04-exploring-state-in-jetpack-compose/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1712236976/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><article class="m-4 md:m-12"><div class="grid md:grid-cols-2 gap-4"><div class="text-left font-medium"><a href>↵ Back</a></div> <div class="text-center md:text-right"><p class="md:font-medium text-sm md:text-base">Published April 4, 2024, last updated April 4, 2024</p></div></div> <header class="p-4 py-16 md:p-12 md:py-40 text-center text-white my-10 space-y-20 bg-indigo-300"><div class="max-w-4xl mx-auto"><h1 class="text-xl md:text-4xl font-thin">Exploring State in Jetpack Compose</h1></div></header> <!----> <div class="max-w-2xl mx-auto space-y-6 nuxt-content"><p>I'm new to Jetpack Compose development and while I've been working reasonably productively on a Compose project I've found myself trusting in the magic of Compose in some places more than what I'm comfortable with in terms of my own knowledge.</p>
<p>So in this post I'm exploring more of how state works in Jetpack Compose.</p>
<p>Declarative UI shifts the UI development workflow from precedural step-by-step instructions on how to build and manipuilate what the user sees to modelling a state that when mutated will update the UI to reflect the change.</p>
<p>In Jetpack Compose, this is done with composable functions and in most cases <code>MutableState&lt;T></code>. We can however observe other types of state, as long as when we bind that state to our composable we do so as a <code>State&lt;T></code>. So although we may have other types we can use to model our state, such as LiveData and MutableStateFlows, at the point at which these types trigger a recomposition in Compose they're a <code>State&lt;T></code>; so for the purposes of this post, we can limit our scope to MutableState.</p>
<p>State is generally added to our composables using code similar to this:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword">fun</span> <span class="token function">HelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> greeting <span class="token keyword">by</span> remember <span class="token punctuation">{</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Hello"</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>

    <span class="token function">Text</span><span class="token punctuation">(</span>
        text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">greeting</span></span><span class="token string">, World!"</span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Any change to <code>greeting</code> in the code above will trigger a recomposition of our <code>HelloWorld()</code> composable.</p>
<p>This post is really about exploring what happens in the single line of code <code>var greeting by remember { mutableStateOf("Hello")}</code> which we sometimes might see written with an <code>=</code> instead of <code>by</code>.</p>
<h2 id="the-difference-between--and-by-remember-mutablestateof"><a aria-hidden="true" href="#the-difference-between--and-by-remember-mutablestateof" tabindex="-1"><span class="icon icon-link"></span></a>The difference between <code>=</code> and <code>by</code> remember mutableStateOf</h2>
<p>The practical difference between <code>= remember</code> and <code>by remember</code> is that when you use <code>by</code> you no longer need to access the .value property of your variable explicitly. So <code>if (foo.value) { }</code> becomes simply <code>if (foo) {}</code> and our code becomes prettier and more concise.</p>
<p>For example:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword">fun</span> <span class="token function">FooBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> text <span class="token operator">=</span> remember <span class="token punctuation">{</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Foo"</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>

    <span class="token function">Text</span><span class="token punctuation">(</span>
        text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Hello, would you like some </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">text<span class="token punctuation">.</span>value</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?"</span></span><span class="token punctuation">,</span>
        modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">clickable</span> <span class="token punctuation">{</span>
            text<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Bar"</span></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Becomes:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword">fun</span> <span class="token function">FooBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> text <span class="token keyword">by</span> remember <span class="token punctuation">{</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Foo"</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>

    <span class="token function">Text</span><span class="token punctuation">(</span>
        text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Hello, would you like some </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">text</span></span><span class="token string">?"</span></span><span class="token punctuation">,</span>
        modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">clickable</span> <span class="token punctuation">{</span>
            text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Bar"</span></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Going past the visible code outcome and looking more into what's going on behind the scenes</p>
<p>When we move from:</p>
<p><code>val foo = remember { mutableStateOf("bar") }</code></p>
<p>To:</p>
<p><code>var foo by remember { mutableStateOf("bar") }</code></p>
<p>Changing <code>=</code> to <code>by</code> moves from an assignment to a property delegation. Property delegation is a Kotlin feature that delegates the getting and setting of a property to an intermediate object.</p>
<p>This is a cool feature of Kotlin and it's worth taking a moment to think about what's going on here. Above, we have to change <code>var</code> to <code>val</code>. At a first take this seems kind of unnecessary, if our delegate is a reference type why do we need to use a <code>var</code>?</p>
<p>It's because we're not actually assigning anything here. When we use <code>by</code> we're not assigning a delegate to <code>foo</code>, we're telling Kotlin there's a delegate somewhere we want to be <strong>responsible</strong> for <code>foo</code>.</p>
<p>It's easily understood when seeing what the Kotlin compiler does when we use <code>by</code>. If we write something like:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-kotlin"><code><span class="token keyword">class</span> FooBar <span class="token punctuation">{</span>
    <span class="token keyword">var</span> text<span class="token operator">:</span> String <span class="token keyword">by</span> <span class="token function">FooBarTextDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The compiler will generate something like:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-kotlin"><code><span class="token keyword">class</span> FooBar <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> text$delegate <span class="token operator">=</span> <span class="token function">FooBarTextDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> text<span class="token operator">:</span> String
        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> text$delegate<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">::</span>text<span class="token punctuation">)</span>
        <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">=</span> text$delegate<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">::</span>text<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>So our delegate gets stored in a private property <code>text$delegate</code> and our getters and setters call its <code>getValue</code> and <code>setValue</code> methods.</p>
<p>Our <code>MutableState</code> (returned by <code>mutableStateOf()</code>) delegate just redirects to the <code>value</code> property:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-kotlin"><code><span class="token keyword">inline</span> <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> MutableState<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>thisObj<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">,</span> property<span class="token operator">:</span> KProperty<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">,</span> value<span class="token operator">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
<span class="token punctuation">}</span>

<span class="token keyword">inline</span> <span class="token keyword">operator</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> State<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>thisObj<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">,</span> property<span class="token operator">:</span> KProperty<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token operator">=</span> value
</code></pre></div>
<h2 id="remembering-remember"><a aria-hidden="true" href="#remembering-remember" tabindex="-1"><span class="icon icon-link"></span></a>Remembering <code>remember</code></h2>
<p>Let's remember that <code>remember</code> is needed so our values will survive recomposition. If we rewrote our <code>FooBar</code> composable above and removed the <code>remember</code> whenever we tapped 'Foo' it would never change to 'Bar' because the update of our MutableState would cause a recomposition which would then ironically cause our value to be lost and set right back to 'Foo' on every tap.</p>
<p>Below is the source code for <code>remember</code>:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-swift"><code>inline fun <span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token function">remember</span><span class="token punctuation">(</span>crossinline calculation<span class="token punctuation">:</span> <span class="token attribute atrule">@DisallowComposableCalls</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">T</span> <span class="token operator">=</span>
    currentComposer<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> calculation<span class="token punctuation">)</span>
</code></pre></div>
<p>So we can see when we call remember we lift the lambda out of the composable and onto the <code>cache</code> property on currentComposer.</p>
<p>For this to make sense we need to know that when you add the <code>@Composable</code> annotation to your composable function it rewrites it to accept a <code>Composer</code> parameter:</p>
<p>So</p>
<p><code>@Composable fun FooBar() {</code></p>
<p>becomes</p>
<p><code>fun FooBar($composer: Composer) {</code></p>
<p>The compiler also does the same for any call to a composable function within that function, which includes <code>remember</code>.</p>
<p>When recomposition happens, if we've used remember, the current Composer is passed back into our composable function and its remember function and we have access to our same value that was stored during initial composition again.</p>
<h2 id="wrapping-up"><a aria-hidden="true" href="#wrapping-up" tabindex="-1"><span class="icon icon-link"></span></a>Wrapping up</h2>
<p>Reading backwards through the line:</p>
<p><code>var foo by remember { mutableStateOf("Foo") }</code></p>
<p>from:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-kotlin"><code><span class="token annotation builtin">@Composable</span>
<span class="token keyword">fun</span> <span class="token function">FooBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> text <span class="token keyword">by</span> remember <span class="token punctuation">{</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Foo"</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>

    <span class="token function">Text</span><span class="token punctuation">(</span>
        text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Hello, would you like some </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">text</span></span><span class="token string">?"</span></span><span class="token punctuation">,</span>
        modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">clickable</span> <span class="token punctuation">{</span>
            text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Bar"</span></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>On initial composition, we get a MutableState for our string "Foo" by calling <code>mutableStateOf</code></p>
<p>We store that in a lambda which <code>remember</code> adds to a cache on the Composer object that will be passed into it from its containing composable.</p>
<p>We create a delegate with <code>by</code> that makes our MutableState less verbose to work with.</p>
<p>When we change the value of our MutableState from "Foo" to "Bar" we trigger recomposition, when our Composable is recompositioned the composer containing our lambda which contains our MutableState which now holds "Bar" instead of "Foo" is passed back into it and our Text() now shows "Bar" instead of "Foo" too, because our triggering MutableState was remembered instead of being recreated.</p>
<p>And while this semi-detailed account still skips over a lot of detail, that's essentially how our state is being handled in Compose.</p>
<p>Breaking it down this way has helped me understand the code I'm writing in Compose a lot better. If you've stumbled upon this post, I hope it's done the same for you – if not, soz mate.</p></div></article></div></div><script defer src="/_nuxt/static/1712236976/2024-04-04-exploring-state-in-jetpack-compose/state.js"></script><script src="/_nuxt/e3b6090.js" defer></script><script src="/_nuxt/9414bce.js" defer></script><script src="/_nuxt/cf78498.js" defer></script><script src="/_nuxt/e5a50fc.js" defer></script><script src="/_nuxt/f8e746f.js" defer></script>
  </body>
</html>
